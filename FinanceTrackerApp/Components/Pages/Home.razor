@page "/"
@attribute [Authorize]

@using FinanceTrackerApp.Services
@using FinanceTrackerApp.Components.Shared

@inject BudgetCalculationService? BudgetCalculationService
@inject AuthService AuthService
@inject NavigationManager NavManager

<div class="glass card">
    <h2>Dashboard</h2>
    <p>Your money overview. Clean. Private. Powerful.</p>

    <div class="kpis">
        <div class="glass kpi">
            <div class="label">Total Balance</div>
            <div class="value positive">$ 12,540</div>
        </div>

        <div class="glass kpi">
            <div class="label">Monthly Income</div>
            <div class="value income">$ 4,850</div>
        </div>

        <div class="glass kpi">
            <div class="label">Monthly Expenses</div>
            <div class="value negative">$ 1,920</div>
        </div>
    </div>

    <!-- Budget Summary Widget -->
    <div style="margin-top: 1.5rem;">
        @if (budgetSummary != null)
        {
            <BudgetSummaryWidget Summary="@budgetSummary" 
                                 Year="@DateTime.Today.Year" 
                                 Month="@DateTime.Today.Month"
                                 OnViewDetails="@(() => NavManager.NavigateTo("/budget"))" />
        }
    </div>

    <div style="margin-top: 1.1rem;">
        <h2 style="margin-bottom: .6rem;">Recent Transactions</h2>

        <div class="tx">
            <div class="tx-left">
                <div class="tx-icon">ðŸ›’</div>
                <div>
                    <div class="tx-title">Groceries</div>
                    <div class="tx-sub">Food â€¢ Today</div>
                </div>
            </div>
            <div class="amount expense">- $ 28.40</div>
        </div>

        <div class="tx">
            <div class="tx-left">
                <div class="tx-icon">ðŸš•</div>
                <div>
                    <div class="tx-title">Transport</div>
                    <div class="tx-sub">Taxi â€¢ Yesterday</div>
                </div>
            </div>
            <div class="amount expense">- $ 12.00</div>
        </div>

        <div class="tx">
            <div class="tx-left">
                <div class="tx-icon">ðŸ’¼</div>
                <div>
                    <div class="tx-title">Salary</div>
                    <div class="tx-sub">Income â€¢ Jan 25</div>
                </div>
            </div>
            <div class="amount income">+ $ 1,200.00</div>
        </div>
    </div>
</div>

@code {
    private BudgetSummary? budgetSummary;

    protected override async Task OnInitializedAsync()
    {
        var userId = await AuthService.GetCurrentUserIdAsync();
        if (!string.IsNullOrWhiteSpace(userId) && BudgetCalculationService != null)
        {
            budgetSummary = await BudgetCalculationService.GetBudgetSummaryAsync(
                userId, 
                DateTime.Today.Year, 
                DateTime.Today.Month
            );
        }
    }
}
