@page "/add-transaction"
@using FinanceTrackerApp.Models
@using FinanceTrackerApp.Services
@inject TransactionService TransactionService
@inject NavigationManager NavigationManager

<EditForm Model="@newTx" OnValidSubmit="SaveTransaction">
    <DataAnnotationsValidator />
    <ValidationSummary class="validation-summary" />
    <div class="glass card" style="padding:1rem; max-width:500px; margin:auto;">
        <h2 class="strong" style="color: var(--text);">Add Transaction</h2>
        <p style=" margin-bottom: 15px">Add a new transaction to keep track of.</p>

        <div class="form-grid" style="display:grid; gap:.5rem;">
            <div class="field">
                <label>Amount (USD)</label>
                <input class="input" type="number" @bind="newTx.Amount" placeholder="0.00" />
            </div>

            <div class="field">
                <label>Type</label>
                <select class="input" @bind="newTx.Type">
                    <option value="expense">Expense</option>
                    <option value="income">Income</option>
                </select>
            </div>

            <div class="field">
                <label>Date</label>
                <input type="date" class="input" @bind="newTx.Date" />
            </div>

            <div class="field">
                <label>Category</label>
                @if (newTx.Type == "expense")
                {
                    <select class="input" @bind="newTx.Category">
                        <option value="Food">Food</option>
                        <option value="Bills">Bills</option>
                        <option value="Health / Medical">Health / Medical</option>
                        <option value="Personal">Personal</option>
                        <option value="Entertainment">Entertainment</option>
                        <option value="Housing / Rent">Housing / Rent</option>
                        <option value="Transportation">Transportation</option>
                    </select>
                }
                else if (newTx.Type == "income")
                {
                    <select class="input" @bind="newTx.Category">
                        <option value="Salary">Salary</option>
                        <option value="Bonus">Bonus</option>
                        <option value="Freelance">Freelance</option>
                        <option value="Investment">Investment</option>
                    </select>
                }
            </div>

            <div class="field">
                <label>Description</label>
                <input class="input" type="text" @bind="newTx.Description" placeholder="Optional description" />
            </div>

            <div style="margin-top:1rem; margin: auto;">
                <button type="submit" class="btn btn-primary">Save</button>
                <button class="btn btn-ghost" @onclick="Cancel">Cancel</button>
            </div>
        </div>
    </div>
</EditForm>

@code {
    private Transaction newTx = new Transaction
    {
        Date = DateTime.Today,
        Type = "expense"
    };

    private async Task SaveTransaction()
    {
        Console.WriteLine("Adding transaction...");
        await TransactionService.AddAsync(newTx);
        Console.WriteLine("Navigating back to /transactions");
        NavigationManager.NavigateTo("/transactions");
    }

    private void Cancel()
    {
        NavigationManager.NavigateTo("/transactions");
    }
}